{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "exploit.schema.json",
    "title": "HACCS Exploit",
    "description": "TA2-Generated Exploit Metadata",
    "type": "object",
    
    "required": [ "name", "exploitSpecVersion", "author", "deviceTargets", "localPrivilegeRequired", "exploitType",
                  "targetISA", "landedPrivilegeLevel", "sourceFile", "uuid"],

    "properties": {
        "uuid": {
            "type": "string",
            "format": "uuid",
            "pattern": "^[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}$"
        },

        "name": {
            "type": "string",
            "description": "Human readable and descriptive name, example: CVE identifier and architecture."
        },

        "exploitSpecVersion": {
            "type": "integer",
            "description": "Version of the exploit implementation to which this exploit adheres ",
            "minimum": 0
        },

        "author": {
            "type": "string",
            "description": "The HACCS performer that created the exploit.",
            "format": "uuid",
            "pattern": "^[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}$"
        },

        "exploitType": {
            "type": "string",
            "description": "The type of exploit this Exploit represents.",
            "format": "uuid",
            "pattern": "^[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}$"
        },

        "targetISA": {
            "type": "string",
            "format": "uuid",
            "pattern": "^[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}$",
            "description": "A set of instruction set architectures the exploit works for."
        },

        "targetABI": {
            "type": "string",
            "format": "uuid",
            "pattern": "^[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}$",
            "description": "A set of ABIs the exploit works for [optional]."
        },

        "softwareTargets": {
            "type": "array",
            "description": "A set of Software services the exploit targets.",
            "items": {
                "type": "object",
                "properties": {
                    "softwareVersions": { "$ref": "softwareVersions.json.schema" },
                    "serviceVersions": {"$ref": "serviceVersions.json.schema" },
                    "port": {
                        "type": "integer",
                        "minimum": 0
                    }
                },
                "required": ["softwareVersions", "serviceVersions", "port"],
                "additionalProperties": false
            }
        },

        "deviceTargets": {
            "type": "array",
            "description": "A set of devices the exploit targets.",
            "items": {
                "type": "object",
                "properties": {
                    "device": {
                        "type": "string",
                        "format": "uuid",
                        "pattern": "^[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}$"
                    },
                    "writableDir": {
                        "type": "string",
                        "minLength": 1
                    },
                    "wasTested": {
                        "type": "boolean"
                    }
                },
                "uniqueItems": true,
                "required": ["device", "writableDir"],
                "minItems": 1,
                "additionalProperties": false
            }
        },

        "effects": {
            "type": "array",
            "description": "A set of effects of the exploit.",
            "items": {
                "type": "string",
                "format": "uuid",
                "pattern": "^[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}$"
                },
            "uniqueItems": true
        },

        "stage0Protocol": {
            "type": "string",
            "description": "The protocol used by the exploit to download the next stage.",
            "format": "uuid",
            "pattern": "^[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}$"
        },
        
        "localPrivilegeRequired": {
            "type": "string",
            "description": "Lowest required privilege level that the exploit needs to run on the local host.",
            "format": "uuid",
            "pattern": "^[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}$"
        },

        "landedPrivilegeLevel": {
            "type": "string",
            "description": "Privilege level of the stage 1 execution context.",
            "format": "uuid",
            "pattern": "^[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}$"
        },

        "successProbability": {
            "type": "integer",
            "description": "The probability the exploit succeeds as an integer percentage (0, 100], if known.",
            "exclusiveMinimum": 0,
            "maximum": 100
        },
        
        "sourceFile" : {
            "type": "string",
            "description": "URI link to source package for exploit.",
            "format": "uri-reference"
        }
    },
    
    "additionalProperties": false
}
