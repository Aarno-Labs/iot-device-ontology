{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "exploit.schema.json",
    "title": "HACCS Exploit",
    "description": "TA2-Generated Exploit Metadata",
    "type": "object",
    
    "required": [ "name", "exploitSpecVersion", "author", "deviceTargets", "localPrivilegeRequired", "exploitType",
                  "targetISA", "landedPrivilegeLevel", "packageBytes"],

    "properties": {
        "url": {
            "type": "string",
            "format": "uri-reference"
        },

        "name": {
            "type": "string",
            "description": "Human readable and descriptive name, example: CVE identifier and architecture."
        },

        "exploitSpecVersion": {
            "type": "integer",
            "description": "Version of the exploit implementation to which this exploit adheres ",
            "minimum": 0
        },

        "author": {
            "type": "string",
            "description": "The HACCS performer that created the exploit.",
            "format": "uri-reference",
            "pattern": ".*/HACCSPerformerType/[0-9]+/"
        },

        "exploitType": {
            "type": "string",
            "description": "The type of exploit this Exploit represents.",
            "format": "uri-reference",
            "pattern": ".*/ExploitType/[0-9]+/"
        },

        "targetISA": {
            "type": "string",
            "format": "uri-reference",
            "pattern": ".*/ISAType/[0-9]+/",
            "description": "A set of instruction set architectures the exploit works for."
        },

        "targetABI": {
            "type": "string",
            "format": "uri-reference",
            "pattern": ".*/ABIType/[0-9]+/",
            "description": "A set of ABIs the exploit works for [optional]."
        },

        "softwareTargets": {
            "type": "array",
            "description": "A set of Software services the exploit targets.",
            "items": {
                "type": "object",
                "properties": {
                    "softwareVersions": { "$ref": "softwareVersions.json.schema" },
                    "serviceVersions": {"$ref": "serviceVersions.json.schema" },
                    "port": {
                        "type": "integer",
                        "minimum": 0
                    }
                },
                "required": ["softwareVersions", "serviceVersions", "port"],
                "additionalProperties": false
            }
        },

        "deviceTargets": {
            "type": "array",
            "description": "A set of devices the exploit targets.",
            "items": {
                "type": "object",
                "properties": {
                    "device": {
                        "type": "string",
                        "format": "uri-reference",
                        "pattern": ".*/Device/[0-9]+/"
                    },
                    "writableDir": {
                        "type": "string",
                        "minLength": 1
                    },
                    "wasTested": {
                        "type": "boolean"
                    }
                },
                "uniqueItems": true,
                "required": ["device", "writableDir"],
                "minItems": 1,
                "additionalProperties": false
            }
        },

        "effects": {
            "type": "array",
            "description": "A set of effects of the exploit.",
            "items": {
                "type": "string",
                "format": "uri-reference",
                "pattern": ".*/ExploitEffect/[0-9]+/"
                },
            "uniqueItems": true
        },

        "stage0Protocol": {
            "type": "string",
            "description": "The protocol used by the exploit to download the next stage.",
            "format": "uri-reference",
            "pattern": ".*/ExploitStage0Protocol/[0-9]+/"
        },
        
        "localPrivilegeRequired": {
            "type": "string",
            "description": "Lowest required privilege level that the exploit needs to run on the local host.",
            "format": "uri-reference",
            "pattern": ".*/PrivilegeType/[0-9]+/"
        },

        "landedPrivilegeLevel": {
            "type": "string",
            "description": "Privilege level of the stage 1 execution context.",
            "format": "uri-reference",
            "pattern": ".*/PrivilegeType/[0-9]+/"
        },

        "successProbability": {
            "type": "integer",
            "description": "The probability the exploit succeeds as an integer percentage (0, 100], if known.",
            "exclusiveMinimum": 0,
            "maximum": 100
        },

        "packageBytes" : {
            "type": "string",
            "description": "The base64 encoded exploit source package as gzip or bz2'ed tar archive or as a .zip archive.",
            "contentEncoding": "base64"
        }
    },
    
    "additionalProperties": false
}
