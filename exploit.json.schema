{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "exploit.schema.json",
    "title": "HACCS Exploit",
    "description": "TA2-Generated Exploit Metadata",
    "type": "object",
    
    "required": [ "name", "author", "deviceTargets", "localPrivilegeRequired", "type",
                  "targetISA", "landedPrivilegeLevel"],

    "properties": {
        "pk": {
            "type": "integer",
            "minimum": 0
        },

        "name": {
            "type": "string",
            "description": "Human readable and descriptive name, example: CVE identifier and architecture."
        },

        "author": {
            "type": "string",
            "description": "The HACCS performer that created the exploit.",
            "format": "uri-reference",
            "pattern": "haccsperformer/[0-9]+/"
        },

        "type": {
            "type": "string",
            "description": "The type of exploit this Exploit represents.",
            "format": "uri-reference",
            "pattern": "exploittype/[0-9]+/"
        },

        "targetISA": {
            "type": "string",
            "format": "uri-reference",
            "pattern": "isatype/[0-9]+/",
            "description": "A set of instruction set architectures the exploit works for."
        },

        "targetABI": {
            "type": "string",
            "format": "uri-reference",
            "pattern": "abitype/[0-9]+/",
            "description": "A set of ABIs the exploit works for [optional]."
        },

        "softwareTargets": {
            "type": "array",
            "description": "A set of Software services the exploit targets.",
            "items": {
                "type": "object",
                "properties": {
                    "softwareVersions": { "$ref": "softwareVersions.json.schema" },
                    "serviceVersions": {"$ref": "serviceVersions.json.schema" },
                    "port": {
                        "type": "integer",
                        "minimum": 0
                    }
                },
                "required": ["softwareVersions", "serviceVersions", "port"],
                "additionalProperties": false
            }
        },

        "deviceTargets": {
            "type": "array",
            "description": "A set of devices the exploit targets.",
            "items": {
                "type": "object",
                "properties": {
                    "device": {
                        "type": "string",
                        "format": "uri-reference",
                        "pattern": "device/[0-9]+/"
                    },
                    "writableDir": {
                        "type": "string",
                        "minLength": 1
                    },
                    "wasTested": {
                        "type": "boolean"
                    }
                },
                "uniqueItems": true,
                "required": ["device", "writableDir"],
                "minItems": 1,
                "additionalProperties": false
            }
        },

        "effects": {
            "type": "array",
            "description": "A set of effects of the exploit.",
            "items": {
                "type": "string",
                "format": "uri-reference",
                "pattern": "exploiteffect/[0-9]+/"
                },
            "uniqueItems": true
        },

        "stage0Protocol": {
            "type": "string",
            "description": "The protocol used by the exploit to download the next stage.",
            "format": "uri-reference",
            "pattern": "exploitstage0protocol/[0-9]+/"
        },
        
        "localPrivilegeRequired": {
            "type": "string",
            "description": "Lowest required privilege level that the exploit needs to run on the local host.",
            "format": "uri-reference",
            "pattern": "privilegetype/[0-9]+/"
        },

        "landedPrivilegeLevel": {
            "type": "string",
            "description": "Privilege level of the stage 1 execution context.",
            "format": "uri-reference",
            "pattern": "privilegetype/[0-9]+/"
        },

        "successProbability": {
            "type": "integer",
            "description": "The probability the exploit succeeds as an integer percentage (0, 100], if known.",
            "exclusiveMinimum": 0,
            "maximum": 100
        }
    }
}
